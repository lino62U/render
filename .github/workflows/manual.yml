name: Automated Workflow

on:
  issues:
    types:
      - opened

jobs:
  move-to-ready:
    runs-on: ${{ matrix.os }}
    env:
      PROJECT_ID: 6 # Reemplaza con el ID real de tu proyecto
    strategy:
      matrix:
        os: [windows-latest]

    steps:
      - name: Move Issue to Ready Column
        run: |
          # Obtener el token de GitHub
          GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}
          
          # Obtener el ID del proyecto
          PROJECT_ID=${{ env.PROJECT_ID }}
          
          # Listar proyectos usando la API REST de GitHub
          PROJECTS=$(curl -s -H "Authorization: Bearer $GITHUB_TOKEN" \
            "https://api.github.com/repos/${GITHUB_REPOSITORY}/projects")
          
          # Extraer el ID de la columna 'Ready'
          READY_COLUMN_ID=$(echo "$PROJECTS" | jq -r '.[] | select(.name == "Ready") | .columns[].id')
          
          # Mover la tarjeta a la columna 'Ready'
          curl -X POST -H "Authorization: Bearer $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.inertia-preview+json" \
            "https://api.github.com/projects/columns/cards/${{ context.payload.issue.card_id }}/moves" \
            -d "{\"position\": \"top\", \"column_id\": \"$READY_COLUMN_ID\"}"
